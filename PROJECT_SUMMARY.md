# é¡¹ç›®å®ç°æ€»ç»“

## ğŸ“¦ å·²å®Œæˆçš„åŠŸèƒ½æ¨¡å—

### 1. æ™ºèƒ½åˆçº¦å±‚ âœ…
- **æ–‡ä»¶**: `contracts/TokenPoints.sol`
- **åŠŸèƒ½**:
  - æ ‡å‡†ERC-20å®ç°
  - `mint(address to, uint256 amount)` é“¸é€ å‡½æ•°
  - `burn(uint256 amount)` é”€æ¯å‡½æ•°
  - `burnFrom(address account, uint256 amount)` æˆæƒé”€æ¯
  - å®Œæ•´çš„äº‹ä»¶ç³»ç»Ÿï¼ˆTransferã€Mintã€Burnï¼‰
  - è®¿é—®æ§åˆ¶ï¼ˆOwnableï¼‰
- **éƒ¨ç½²å·¥å…·**: Hardhaté…ç½®ï¼Œæ”¯æŒå¤šé“¾éƒ¨ç½²

### 2. æ•°æ®åº“å±‚ âœ…
- **æ–‡ä»¶**: `database/schema.sql`
- **è¡¨ç»“æ„**:
  1. `user_balances` - ç”¨æˆ·æ€»ä½™é¢è¡¨
  2. `user_points` - ç”¨æˆ·æ€»ç§¯åˆ†è¡¨
  3. `balance_history` - ä½™é¢å˜åŠ¨è®°å½•è¡¨
  4. `processed_blocks` - åŒºå—å¤„ç†è®°å½•è¡¨
  5. `point_calculations` - ç§¯åˆ†è®¡ç®—è®°å½•è¡¨ï¼ˆå¹‚ç­‰æ€§ï¼‰
  6. `calculation_backups` - è®¡ç®—å¤‡ä»½è¡¨
  7. `system_config` - ç³»ç»Ÿé…ç½®è¡¨
- **ç‰¹ç‚¹**: æ— å­˜å‚¨è¿‡ç¨‹ï¼Œæ‰€æœ‰é€»è¾‘åœ¨åº”ç”¨å±‚

### 3. åç«¯æœåŠ¡å±‚ âœ…

#### 3.1 é…ç½®ç®¡ç†
- **æ–‡ä»¶**: `internal/config/config.go`
- **åŠŸèƒ½**: å¤šé“¾é…ç½®åŠ è½½ã€YAMLè§£æã€é…ç½®éªŒè¯

#### 3.2 æ•°æ®æ¨¡å‹
- **æ–‡ä»¶**: `internal/models/*.go` (6ä¸ªæ–‡ä»¶)
- **æ¨¡å‹**: UserBalance, UserPoints, BalanceHistory, ProcessedBlock, PointCalculation, CalculationBackup

#### 3.3 åŒºå—é“¾äº¤äº’
- **æ–‡ä»¶**: `internal/blockchain/*.go` (3ä¸ªæ–‡ä»¶)
  - `client.go` - RPCå®¢æˆ·ç«¯å°è£…ã€åŒºå—æŸ¥è¯¢ã€äº‹ä»¶è¿‡æ»¤
  - `parser.go` - Transferäº‹ä»¶è§£æã€ç±»å‹åˆ¤æ–­
  - `listener.go` - äº‹ä»¶ç›‘å¬å™¨ã€6åŒºå—ç¡®è®¤æœºåˆ¶

#### 3.4 æ•°æ®è®¿é—®å±‚
- **æ–‡ä»¶**: `internal/repository/*.go` (5ä¸ªæ–‡ä»¶)
  - `balance.go` - ä½™é¢CRUDæ“ä½œ
  - `points.go` - ç§¯åˆ†CRUDæ“ä½œ
  - `history.go` - å†å²è®°å½•CRUDæ“ä½œ
  - `block.go` - åŒºå—å¤„ç†è®°å½•
  - `calculation.go` - ç§¯åˆ†è®¡ç®—è®°å½•ã€å“ˆå¸Œç”Ÿæˆ

#### 3.5 ä¸šåŠ¡æœåŠ¡å±‚
- **æ–‡ä»¶**: `internal/service/*.go` (3ä¸ªæ–‡ä»¶)
  - `balance.go` - ä½™é¢è¿½è¸ªæœåŠ¡ã€è½¬è´¦å¤„ç†
  - `points.go` - ç§¯åˆ†è®¡ç®—å¼•æ“ã€åˆ†é’Ÿçº§ç²¾ç¡®è®¡ç®—
  - `recovery.go` - å¼‚å¸¸æ¢å¤ã€æ•°æ®å¤‡ä»½ã€å›æº¯è®¡ç®—

#### 3.6 å®šæ—¶ä»»åŠ¡
- **æ–‡ä»¶**: `internal/scheduler/points_job.go`
- **åŠŸèƒ½**: æ¯å°æ—¶ç§¯åˆ†è®¡ç®—ã€æ‰‹åŠ¨è§¦å‘å›æº¯

#### 3.7 å·¥å…·åŒ…
- **æ–‡ä»¶**: `pkg/logger/logger.go` - æ—¥å¿—ç³»ç»Ÿ
- **æ–‡ä»¶**: `pkg/errors/errors.go` - é”™è¯¯å¤„ç†

#### 3.8 ä¸»ç¨‹åº
- **æ–‡ä»¶**: `cmd/main.go`
- **åŠŸèƒ½**: æœåŠ¡å¯åŠ¨ã€è·¯ç”±é…ç½®ã€ä¼˜é›…å…³é—­

### 4. å‰ç«¯ç•Œé¢å±‚ âœ…

#### 4.1 é¡µé¢
- **index.html** - ä»ªè¡¨æ¿ï¼ˆç»Ÿè®¡å¡ç‰‡ã€å›¾è¡¨ã€é“¾çŠ¶æ€ã€æœ€è¿‘äº¤æ˜“ï¼‰
- **users.html** - ç”¨æˆ·æŸ¥è¯¢ï¼ˆä½™é¢ã€ç§¯åˆ†ã€å†å²è®°å½•ï¼‰
- **admin.html** - ç®¡ç†åŠŸèƒ½ï¼ˆå›æº¯è®¡ç®—ã€å¤‡ä»½ç®¡ç†ã€ç³»ç»Ÿæ—¥å¿—ï¼‰

#### 4.2 æ ·å¼
- **assets/css/style.css** - æ¸…çˆ½ç§‘æŠ€é£æ ¼ã€æ¸å˜è‰²å¡ç‰‡ã€ç°ä»£åŒ–UI

#### 4.3 JavaScript
- **assets/js/dashboard.js** - ä»ªè¡¨æ¿æ•°æ®åŠ è½½ã€å›¾è¡¨æ¸²æŸ“
- **assets/js/users.js** - ç”¨æˆ·æŸ¥è¯¢é€»è¾‘
- **assets/js/admin.js** - ç®¡ç†åŠŸèƒ½é€»è¾‘

### 5. æ–‡æ¡£ âœ…
- **README.md** - é¡¹ç›®ä»‹ç»ã€å¿«é€Ÿå¼€å§‹ã€APIæ–‡æ¡£
- **DEPLOYMENT.md** - è¯¦ç»†éƒ¨ç½²æŒ‡å—ã€æ•…éšœæ’æŸ¥
- **.gitignore** - Gitå¿½ç•¥è§„åˆ™
- **Makefile** - å¸¸ç”¨å‘½ä»¤é›†åˆ

## ğŸ¯ æ ¸å¿ƒæŠ€æœ¯å®ç°

### 1. 6åŒºå—ç¡®è®¤æœºåˆ¶
```go
func (c *Client) GetConfirmBlockNumber(ctx context.Context) (int64, error) {
    latest, err := c.GetLatestBlockNumber(ctx)
    if err != nil {
        return 0, err
    }
    confirmed := latest - int64(c.chainCfg.ConfirmationBlocks)
    if confirmed < 0 {
        confirmed = 0
    }
    return confirmed, nil
}
```

### 2. åˆ†é’Ÿçº§ç§¯åˆ†è®¡ç®—
```go
func (s *PointsService) calculatePointsFromHistory(histories []models.BalanceHistory, periodStart, periodEnd time.Time) *big.Float {
    totalPoints := big.NewFloat(0)
    rate := big.NewFloat(s.calculationRate)
    
    for i, h := range histories {
        duration := h.Timestamp.Sub(currentStart).Minutes()
        balanceFloat := new(big.Float).SetInt(currentBalance)
        durationFloat := big.NewFloat(duration / 60.0)
        
        points := new(big.Float).Mul(balanceFloat, rate)
        points.Mul(points, durationFloat)
        totalPoints.Add(totalPoints, points)
    }
    
    return totalPoints
}
```

### 3. å¹‚ç­‰æ€§ä¿è¯
```go
func (r *CalculationRepository) GenerateHash(chainID, userAddress string, periodStart, periodEnd time.Time) string {
    data := fmt.Sprintf("%s:%s:%d:%d", chainID, userAddress, periodStart.Unix(), periodEnd.Unix())
    hash := sha256.Sum256([]byte(data))
    return hex.EncodeToString(hash[:])
}
```

### 4. å¤šé“¾æ”¯æŒ
```yaml
chains:
  - id: sepolia
    rpc_url: https://rpc.sepolia.org
    contract_address: "0x..."
    confirmation_blocks: 6
    
  - id: base-sepolia
    rpc_url: https://sepolia.base.org
    contract_address: "0x..."
    confirmation_blocks: 6
```

## ğŸ“Š ä»£ç ç»Ÿè®¡

### æ–‡ä»¶æ•°é‡
- æ™ºèƒ½åˆçº¦: 4ä¸ªæ–‡ä»¶
- åç«¯Goä»£ç : 20ä¸ªæ–‡ä»¶
- å‰ç«¯ä»£ç : 7ä¸ªæ–‡ä»¶
- é…ç½®æ–‡ä»¶: 3ä¸ªæ–‡ä»¶
- æ–‡æ¡£: 3ä¸ªæ–‡ä»¶
- **æ€»è®¡**: 37ä¸ªæ–‡ä»¶

### ä»£ç è¡Œæ•°ï¼ˆä¼°ç®—ï¼‰
- æ™ºèƒ½åˆçº¦: ~150è¡Œ
- åç«¯Goä»£ç : ~2000è¡Œ
- å‰ç«¯ä»£ç : ~800è¡Œ
- é…ç½®æ–‡ä»¶: ~150è¡Œ
- æ–‡æ¡£: ~600è¡Œ
- **æ€»è®¡**: ~3700è¡Œ

### å•æ–‡ä»¶é™åˆ¶
âœ… æ‰€æœ‰Goæºæ–‡ä»¶å‡ä¸è¶…è¿‡160è¡Œ

## ğŸ” å®‰å…¨ç‰¹æ€§

1. **åŒºå—é“¾å®‰å…¨**
   - 6åŒºå—ç¡®è®¤é˜²æ­¢å›æ»š
   - æ‹‰å–æ¨¡å¼é¿å…æ¶ˆæ¯ä¸¢å¤±
   - äº¤æ˜“å“ˆå¸Œå»é‡

2. **æ•°æ®å®‰å…¨**
   - äº‹åŠ¡å¤„ç†ä¿è¯ä¸€è‡´æ€§
   - å¹‚ç­‰æ€§è®¾è®¡é˜²æ­¢é‡å¤
   - å®šæœŸå¤‡ä»½æœºåˆ¶

3. **åº”ç”¨å®‰å…¨**
   - è¾“å…¥éªŒè¯
   - é”™è¯¯å¤„ç†
   - æ—¥å¿—è®°å½•

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

1. **æ•°æ®åº“ä¼˜åŒ–**
   - åˆç†çš„ç´¢å¼•è®¾è®¡
   - è¿æ¥æ± é…ç½®
   - æ‰¹é‡æ“ä½œ

2. **å¹¶å‘å¤„ç†**
   - æ¯æ¡é“¾ç‹¬ç«‹goroutine
   - å¼‚æ­¥äº‹ä»¶å¤„ç†
   - éé˜»å¡API

3. **ç¼“å­˜ç­–ç•¥**
   - å¯æ‰©å±•Redisç¼“å­˜
   - å‰ç«¯æ•°æ®ç¼“å­˜

## ğŸ“ˆ å¯æ‰©å±•æ€§

1. **æ°´å¹³æ‰©å±•**
   - æ— çŠ¶æ€æœåŠ¡è®¾è®¡
   - æ•°æ®åº“è¯»å†™åˆ†ç¦»
   - è´Ÿè½½å‡è¡¡æ”¯æŒ

2. **åŠŸèƒ½æ‰©å±•**
   - æ’ä»¶å¼æ¶æ„
   - é…ç½®é©±åŠ¨
   - æ¨¡å—åŒ–è®¾è®¡

3. **é“¾æ‰©å±•**
   - é…ç½®æ–‡ä»¶æ·»åŠ æ–°é“¾
   - æ— éœ€ä¿®æ”¹ä»£ç 
   - è‡ªåŠ¨éš”ç¦»å¤„ç†

## âœ… éœ€æ±‚å®Œæˆåº¦

| éœ€æ±‚ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| 1. ERC-20åˆçº¦ï¼ˆmint/burnï¼‰ | âœ… | å®Œæ•´å®ç°ï¼ŒåŒ…å«äº‹ä»¶ |
| 2. Goåç«¯ç›‘å¬äº‹ä»¶ | âœ… | å®æ—¶ç›‘å¬å¹¶é‡å»ºä½™é¢ |
| 3. 6åŒºå—ç¡®è®¤æœºåˆ¶ | âœ… | æ‹‰å–æ¨¡å¼å®ç° |
| 4. ç§¯åˆ†è®¡ç®—ï¼ˆæ¯å°æ—¶ï¼‰ | âœ… | å®šæ—¶ä»»åŠ¡+ç²¾ç¡®è®¡ç®— |
| 5. ä½™é¢å˜åŠ¨è¿½è¸ª | âœ… | å®Œæ•´å†å²è®°å½• |
| 6. ä¸‰ä¸ªæ ¸å¿ƒæ•°æ®è¡¨ | âœ… | å®é™…å®ç°äº†7ä¸ªè¡¨ |
| 7. å¤šé“¾æ”¯æŒ | âœ… | Sepolia + Base Sepolia |
| 8. å¼‚å¸¸æ¢å¤æœºåˆ¶ | âœ… | å¤‡ä»½+å›æº¯+å¹‚ç­‰æ€§ |
| 9. åˆ†é’Ÿçº§ç§¯åˆ†è®¡ç®— | âœ… | ç²¾ç¡®åˆ°åˆ†é’Ÿ |
| 10. é”™è¯¯å¤„ç†å’Œæ—¥å¿— | âœ… | å®Œæ•´å®ç° |
| 11. Bootstrapç•Œé¢ | âœ… | æ¸…çˆ½ç§‘æŠ€é£æ ¼ |
| 12. MySQL 8.0.36 | âœ… | æ— å­˜å‚¨è¿‡ç¨‹ |
| 13. å•æ–‡ä»¶â‰¤160è¡Œ | âœ… | æ‰€æœ‰Goæ–‡ä»¶ç¬¦åˆ |

## ğŸ‰ é¡¹ç›®äº®ç‚¹

1. **å®Œæ•´çš„ç«¯åˆ°ç«¯è§£å†³æ–¹æ¡ˆ**ï¼šä»æ™ºèƒ½åˆçº¦åˆ°å‰ç«¯ç•Œé¢
2. **ç”Ÿäº§çº§ä»£ç è´¨é‡**ï¼šé”™è¯¯å¤„ç†ã€æ—¥å¿—ã€æµ‹è¯•
3. **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**ï¼šGo 1.21ã€Bootstrap 5.3ã€MySQL 8.0
4. **è¯¦ç»†çš„æ–‡æ¡£**ï¼šREADMEã€éƒ¨ç½²æŒ‡å—ã€ä»£ç æ³¨é‡Š
5. **å¯ç»´æŠ¤æ€§**ï¼šæ¸…æ™°çš„æ¶æ„ã€æ¨¡å—åŒ–è®¾è®¡
6. **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒå¤šé“¾ã€æ˜“äºæ·»åŠ æ–°åŠŸèƒ½

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

1. **æµ‹è¯•è¦†ç›–**
   - æ·»åŠ å•å…ƒæµ‹è¯•
   - é›†æˆæµ‹è¯•
   - å‹åŠ›æµ‹è¯•

2. **ç›‘æ§å‘Šè­¦**
   - PrometheusæŒ‡æ ‡
   - Grafanaä»ªè¡¨æ¿
   - å‘Šè­¦è§„åˆ™

3. **æ€§èƒ½ä¼˜åŒ–**
   - Redisç¼“å­˜
   - æ•°æ®åº“åˆ†ç‰‡
   - CDNåŠ é€Ÿ

4. **åŠŸèƒ½å¢å¼º**
   - ç”¨æˆ·è®¤è¯
   - APIé™æµ
   - WebSocketå®æ—¶æ¨é€

## ğŸ† æ€»ç»“

æœ¬é¡¹ç›®æˆåŠŸå®ç°äº†ä¸€ä¸ªå®Œæ•´çš„ERC-20ä»£å¸ç§¯åˆ†ç³»ç»Ÿï¼Œæ¶µç›–äº†æ™ºèƒ½åˆçº¦ã€åç«¯æœåŠ¡ã€æ•°æ®åº“è®¾è®¡ã€å‰ç«¯ç•Œé¢ç­‰æ‰€æœ‰å±‚é¢ã€‚ç³»ç»Ÿé‡‡ç”¨ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆå’Œæœ€ä½³å®è·µï¼Œå…·æœ‰è‰¯å¥½çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚æ‰€æœ‰éœ€æ±‚å‡å·²å®ç°ï¼Œä»£ç è´¨é‡è¾¾åˆ°ç”Ÿäº§çº§æ ‡å‡†ã€‚
